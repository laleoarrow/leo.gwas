dplyr::select(gene_symbol = gene_name, chr = seqnames, bp_start = start, bp_end = end, strand)
# Clean up chromosome names and strand
result_df <- result_df %>%
dplyr::mutate(
chr = gsub("^chr", "", chr)
)
# If input was a data frame, append the results
if (is.data.frame(genes)) {
final_df <- genes %>%
dplyr::left_join(result_df, by = stats::setNames("gene_symbol", gene_col))
return(final_df)
} else {
return(result_df)
}
}
map_using_gtf(genes = gene_symbols, genome = "hg38")
#' @importFrom rlang sym
#' @importFrom GenomicFeatures makeTxDbFromGFF genes
#' @importFrom rtracklayer import
#' @examples
#' \dontrun{
#' gene_symbols <- c("TP53", "BRCA1", "EGFR")
#' result <- map_using_gtf(genes = gene_symbols, genome = "hg38")
#' print(result)
#' }
#' @export
map_using_gtf <- function(genes, gene_col = NULL, genome = c("hg19", "hg38"), gtf_file = NULL, download_dir = "~/project/ref/gtf") {
genome <- match.arg(genome)
# Process input genes
if (is.data.frame(genes)) {
if (is.null(gene_col) || !(gene_col %in% colnames(genes))) {
stop("Please specify a valid 'gene_col' that exists in the data frame.")
}
gene_col_sym <- rlang::sym(gene_col)
gene_symbols <- genes %>% dplyr::pull(!!gene_col_sym)
input_df <- genes
} else if (is.vector(genes)) {
gene_symbols <- genes
input_df <- data.frame(gene_symbol = gene_symbols, stringsAsFactors = FALSE)
} else {
stop("Input 'genes' must be a vector or a data frame.")
}
# Set default download directory
if (is.null(download_dir)) { download_dir <- "~/project/ref/gtf" }
if (!dir.exists(download_dir)) { dir.create(download_dir, recursive = TRUE) }
message(paste0(">>> Setting the download_dir: ", download_dir, "\n"))
# Download GTF file if not provided
if (is.null(gtf_file)) {
if (genome == "hg19") {
# gtf_url <- "ftp://ftp.ensembl.org/pub/grch37/current/gtf/homo_sapiens/Homo_sapiens.GRCh37.87.gtf.gz"
gtf_url <- "https://ftp.ncbi.nlm.nih.gov/refseq/H_sapiens/annotation/GRCh37_latest/refseq_identifiers/GRCh37_latest_genomic.gtf.gz"
gtf_file <- file.path(download_dir, basename(gtf_url))
} else if (genome == "hg38") {
# gtf_url <- "ftp://ftp.ensembl.org/pub/release-108/gtf/homo_sapiens/Homo_sapiens.GRCh38.108.gtf.gz"
gtf_url <- "https://ftp.ncbi.nlm.nih.gov/refseq/H_sapiens/annotation/GRCh38_latest/refseq_identifiers/GRCh38_latest_genomic.gtf.gz"
gtf_file <- file.path(download_dir, basename(gtf_url))
}
if (!file.exists(gtf_file)) {
message("Downloading GTF file...")
utils::download.file(gtf_url, destfile = gtf_file)
}
}
# Create TxDb object from GTF file
message("Creating TxDb object from GTF file...")
txdb <- suppressMessages( GenomicFeatures::makeTxDbFromGFF(gtf_file, format = "gtf") )
# Retrieve gene locations
gene_locations <- GenomicFeatures::genes(txdb)
gene_locations_df <- as.data.frame(gene_locations)
# Import GTF file to get gene symbols
message("Importing GTF file to get gene symbols...")
gtf_data <- rtracklayer::import(gtf_file)
# Determine available attribute columns
available_cols <- names(S4Vectors::mcols(gtf_data))
if ("gene_name" %in% available_cols) {
gene_id_col <- "gene_id"
gene_name_col <- "gene_name"
} else if ("gene" %in% available_cols) {
gene_id_col <- "gene_id"
gene_name_col <- "gene"
} else {
stop("Neither 'gene_name' nor 'gene' columns are present in the GTF file.")
}
gene_symbols_map <- unique(S4Vectors::mcols(gtf_data)[, c(gene_id_col, gene_name_col)])
colnames(gene_symbols_map) <- c("gene_id", "gene_name")
gene_symbols_map <- as.data.frame(gene_symbols_map)
# Merge gene locations with gene symbols
gene_locations_df <- gene_locations_df %>%
dplyr::left_join(gene_symbols_map, by = c("gene_id"))
# Filter for input gene symbols
result_df <- gene_locations_df %>%
dplyr::filter(gene_name %in% gene_symbols) %>%
dplyr::select(gene_symbol = gene_name, chr = seqnames, bp_start = start, bp_end = end, strand)
# Clean up chromosome names and strand
result_df <- result_df %>%
dplyr::mutate(
chr = sub("^NC_0+|\\..*$", "", chr)
)
# If input was a data frame, append the results
if (is.data.frame(genes)) {
final_df <- genes %>%
dplyr::left_join(result_df, by = stats::setNames("gene_symbol", gene_col))
return(final_df)
} else {
return(result_df)
}
}
map_using_gtf(genes = gene_symbols, genome = "hg38")
result_df
result_df %>%
dplyr::mutate(
chr = sub("^NC_0+|\\..*$", "", chr)
)
result_df %>%
dplyr::mutate(
chr = sub("^NC_0*([0-9]+)\\..*$", "\\1", chr)
)
result_df %>%
dplyr::mutate(
chr = sub("^NC_0*([0-9XYM]+)\\..*$", "\\1", chr)
)
gene_symbols_df <- tibble(GeneName = gene_symbols, OtherInformation = c(1,2,3))
map_using_bioconductor(genes = gene_symbols_df, gene_col = "GeneName" , genome = "hg19")
#' @importFrom rtracklayer import
#' @examples
#' \dontrun{
#' gene_symbols <- c("TP53", "BRCA1", "EGFR")
#' map_using_gtf(genes = gene_symbols, genome = "hg38")
#'
#' gene_symbols_df <- tibble(GeneName = gene_symbols, OtherInformation = c(1,2,3))
#' map_using_gtf(genes = gene_symbols_df, gene_col = "GeneName" , genome = "hg19")
#' }
#' @export
map_using_gtf <- function(genes, gene_col = NULL, genome = c("hg19", "hg38"), gtf_file = NULL, download_dir = "~/project/ref/gtf") {
genome <- match.arg(genome)
# Process input genes
if (is.data.frame(genes)) {
if (is.null(gene_col) || !(gene_col %in% colnames(genes))) {
stop("Please specify a valid 'gene_col' that exists in the data frame.")
}
gene_col_sym <- rlang::sym(gene_col)
gene_symbols <- genes %>% dplyr::pull(!!gene_col_sym)
input_df <- genes
} else if (is.vector(genes)) {
gene_symbols <- genes
input_df <- data.frame(gene_symbol = gene_symbols, stringsAsFactors = FALSE)
} else {
stop("Input 'genes' must be a vector or a data frame.")
}
# Set default download directory
if (is.null(download_dir)) { download_dir <- "~/project/ref/gtf" }
if (!dir.exists(download_dir)) { dir.create(download_dir, recursive = TRUE) }
message(paste0(">>> Setting the download_dir: ", download_dir, "\n"))
# Download GTF file if not provided
if (is.null(gtf_file)) {
if (genome == "hg19") {
# gtf_url <- "ftp://ftp.ensembl.org/pub/grch37/current/gtf/homo_sapiens/Homo_sapiens.GRCh37.87.gtf.gz"
gtf_url <- "https://ftp.ncbi.nlm.nih.gov/refseq/H_sapiens/annotation/GRCh37_latest/refseq_identifiers/GRCh37_latest_genomic.gtf.gz"
gtf_file <- file.path(download_dir, basename(gtf_url))
} else if (genome == "hg38") {
# gtf_url <- "ftp://ftp.ensembl.org/pub/release-108/gtf/homo_sapiens/Homo_sapiens.GRCh38.108.gtf.gz"
gtf_url <- "https://ftp.ncbi.nlm.nih.gov/refseq/H_sapiens/annotation/GRCh38_latest/refseq_identifiers/GRCh38_latest_genomic.gtf.gz"
gtf_file <- file.path(download_dir, basename(gtf_url))
}
if (!file.exists(gtf_file)) {
message("Downloading GTF file...")
utils::download.file(gtf_url, destfile = gtf_file)
}
}
# Create TxDb object from GTF file
message("Creating TxDb object from GTF file...")
txdb <- suppressMessages( GenomicFeatures::makeTxDbFromGFF(gtf_file, format = "gtf") )
# Retrieve gene locations
gene_locations <- GenomicFeatures::genes(txdb)
gene_locations_df <- as.data.frame(gene_locations)
# Import GTF file to get gene symbols
message("Importing GTF file to get gene symbols...")
gtf_data <- rtracklayer::import(gtf_file)
# Determine available attribute columns
available_cols <- names(S4Vectors::mcols(gtf_data))
if ("gene_name" %in% available_cols) {
gene_id_col <- "gene_id"
gene_name_col <- "gene_name"
} else if ("gene" %in% available_cols) {
gene_id_col <- "gene_id"
gene_name_col <- "gene"
} else {
stop("Neither 'gene_name' nor 'gene' columns are present in the GTF file.")
}
gene_symbols_map <- unique(S4Vectors::mcols(gtf_data)[, c(gene_id_col, gene_name_col)])
colnames(gene_symbols_map) <- c("gene_id", "gene_name")
gene_symbols_map <- as.data.frame(gene_symbols_map)
# Merge gene locations with gene symbols
gene_locations_df <- gene_locations_df %>%
dplyr::left_join(gene_symbols_map, by = c("gene_id"))
# Filter for input gene symbols
result_df <- gene_locations_df %>%
dplyr::filter(gene_name %in% gene_symbols) %>%
dplyr::select(gene_symbol = gene_name, chr = seqnames, bp_start = start, bp_end = end, strand)
# Clean up chromosome names and strand
result_df <- result_df %>%
dplyr::mutate(
chr = sub("^NC_0*([0-9XYMT]+)\\..*$", "\\1", chr)
)
# If input was a data frame, append the results
if (is.data.frame(genes)) {
final_df <- genes %>%
dplyr::left_join(result_df, by = stats::setNames("gene_symbol", gene_col))
return(final_df)
} else {
return(result_df)
}
}
map_using_gtf(genes = gene_symbols_df, gene_col = "GeneName" , genome = "hg19")
map_using_bioconductor(genes = gene_symbols_df, gene_col = "GeneName" , genome = "hg19")
gene_symbols_df <- data.frame(GeneName = gene_symbols, OtherInformation = c(1,2,3))
gene_symbols_df
map_using_bioconductor(genes = gene_symbols_df, gene_col = "GeneName" , genome = "hg19")
gene_symbols <- c("TP53", "BRCA1", "EGFR")
result <- leo_map_gene_to_chrbp(
genes = gene_symbols,
method = "bioconductor",
genome = "hg19"
)
#' )
#' result <- leo_map_gene_to_chrbp(
#'   genes = df,
#'   gene_col = "gene_name",
#'   method = "gtf",
#'   genome = "hg38"
#' )
#' print(result)
#' }
#' @export
leo_map_gene_to_chrbp <- function(genes,
gene_col = NULL,
method = c("bioconductor", "gtf"),
genome = c("hg19", "hg38"),
gtf_file = NULL) {
method <- match.arg(method)
genome <- match.arg(genome)
if (method == "bioconductor") {
result <- map_using_bioconductor(genes = genes, gene_col = gene_col, genome = genome)
} else if (method == "gtf") {
result <- map_using_gtf(genes = genes, gene_col = gene_col, genome = genome, gtf_file = gtf_file)
} else {
stop("Invalid method specified.")
}
return(result)
}
result <- leo_map_gene_to_chrbp(
genes = gene_symbols,
method = "bioconductor",
genome = "hg19"
)
result
#' @return A data frame with columns: gene_symbol, chr, bp_start, bp_end, strand.
#' @importFrom dplyr %>% select mutate left_join filter pull
#' @importFrom rlang sym
#' @examples
#' \dontrun{
#' \dontrun{
#' # Using Bioconductor method with a character vector of gene symbols
#' leo_map_gene_to_chrbp(genes = c("TP53", "BRCA1", "EGFR"), method = "bioconductor", genome = "hg19")
#'
#' # Using Bioconductor method with a data frame
leo_map_gene_to_chrbp(genes = data.frame(gene_name = c("TP53", "BRCA1", "EGFR"), value = c(1.2, 3.4, 5.6)),
gene_col = "gene_name", method = "bioconductor", genome = "hg19")
#' leo_map_gene_to_chrbp(genes = c("TP53", "BRCA1", "EGFR"), method = "bioconductor", genome = "hg19")
#'
#' # Using Bioconductor method with a data frame
#' leo_map_gene_to_chrbp(genes = data.frame(gene_name = c("TP53", "BRCA1", "EGFR"), value = c(1.2, 3.4, 5.6)),
#'                       gene_col = "gene_name", method = "bioconductor", genome = "hg19")
#'
#' # Using GTF method with a character vector of gene symbols
#' leo_map_gene_to_chrbp(genes = c("TP53", "BRCA1", "EGFR"), method = "gtf", genome = "hg38")
#'
#' # Using GTF method with a data frame
leo_map_gene_to_chrbp(genes = data.frame(gene_name = c("TP53", "BRCA1", "EGFR"), value = c(1.2, 3.4, 5.6)),
gene_col = "gene_name", method = "gtf", genome = "hg38")
gene_col = "gene_name", method = "gtf", genome = "hg38", download_dir = "~/project/ref/gtf")
leo_map_gene_to_chrbp(genes = data.frame(gene_name = c("TP53", "BRCA1", "EGFR"), value = c(1.2, 3.4, 5.6)),
gene_col = "gene_name", method = "gtf", genome = "hg38", download_dir = "~/project/ref/gtf")
#' }
#' @export
leo_map_gene_to_chrbp <- function(genes,
gene_col = NULL,
method = c("bioconductor", "gtf"),
genome = c("hg19", "hg38"),
...) {
method <- match.arg(method)
genome <- match.arg(genome)
if (method == "bioconductor") {
result <- map_using_bioconductor(genes = genes, gene_col = gene_col, genome = genome)
} else if (method == "gtf") {
result <- map_using_gtf(genes = genes, gene_col = gene_col, genome = genome, ...)
} else {
stop("Invalid method specified.")
}
return(result)
}
#' leo_map_gene_to_chrbp(genes = c("TP53", "BRCA1", "EGFR"), method = "bioconductor", genome = "hg19")
#'
#' # Using Bioconductor method with a data frame
#' leo_map_gene_to_chrbp(genes = data.frame(gene_name = c("TP53", "BRCA1", "EGFR"), value = c(1.2, 3.4, 5.6)),
#'                       gene_col = "gene_name", method = "bioconductor", genome = "hg19")
#'
#' # Using GTF method with a character vector of gene symbols
#' leo_map_gene_to_chrbp(genes = c("TP53", "BRCA1", "EGFR"), method = "gtf", genome = "hg38")
#'
#' # Using GTF method with a data frame
leo_map_gene_to_chrbp(genes = data.frame(gene_name = c("TP53", "BRCA1", "EGFR"), value = c(1.2, 3.4, 5.6)),
#' }
#' @export
leo_map_gene_to_chrbp <- function(genes,
gene_col = NULL,
method = c("bioconductor", "gtf"),
genome = c("hg19", "hg38"),
...) {
method <- match.arg(method)
genome <- match.arg(genome)
if (method == "bioconductor") {
result <- map_using_bioconductor(genes = genes, gene_col = gene_col, genome = genome)
} else if (method == "gtf") {
result <- map_using_gtf(genes = genes, gene_col = gene_col, genome = genome, ...)
} else {
stop("Invalid method specified.")
}
return(result)
}
leo_map_gene_to_chrbp(genes = data.frame(gene_name = c("TP53", "BRCA1", "EGFR"), value = c(1.2, 3.4, 5.6)),
gene_col = "gene_name", method = "gtf", genome = "hg38", download_dir = "~/project/ref/gtf")
# update function information
devtools::document()
txdb <- suppressWarnings( GenomicFeatures::makeTxDbFromGFF(gtf_file, format = "gtf") )
gtf_file <- file.path(download_dir, basename(gtf_url))
txdb <- suppressWarnings( GenomicFeatures::makeTxDbFromGFF(gtf_file, format = "gtf") )
txdb <- suppressWarnings( GenomicFeatures::makeTxDbFromGFF(gtf_file, format = "gtf") )
# Retrieve gene locations
gene_locations <- GenomicFeatures::genes(txdb)
gene_symbols_map <- unique(S4Vectors::mcols(gtf_data)[, c(gene_id_col, gene_name_col)])
colnames(gene_symbols_map) <- c("gene_id", "gene_name")
gene_symbols_map <- as.data.frame(gene_symbols_map)
# Merge gene locations with gene symbols
gene_locations_df <- gene_locations_df %>%
dplyr::left_join(gene_symbols_map, by = c("gene_id"))
# Filter for input gene symbols
result_df <- gene_locations_df %>%
dplyr::filter(gene_name %in% gene_symbols) %>%
dplyr::select(gene_symbol = gene_name, chr = seqnames, bp_start = start, bp_end = end, strand)
# Import GTF file to get gene symbols
message("Importing GTF file to get gene symbols...")
gtf_data <- rtracklayer::import(gtf_file)
# Determine available attribute columns
available_cols <- names(S4Vectors::mcols(gtf_data))
if ("gene_name" %in% available_cols) {
gene_id_col <- "gene_id"
gene_name_col <- "gene_name"
} else if ("gene" %in% available_cols) {
gene_id_col <- "gene_id"
gene_name_col <- "gene"
} else {
stop("Neither 'gene_name' nor 'gene' columns are present in the GTF file.")
}
gene_symbols_map <- unique(S4Vectors::mcols(gtf_data)[, c(gene_id_col, gene_name_col)])
colnames(gene_symbols_map) <- c("gene_id", "gene_name")
gene_symbols_map <- as.data.frame(gene_symbols_map)
# Merge gene locations with gene symbols
gene_locations_df <- gene_locations_df %>%
dplyr::left_join(gene_symbols_map, by = c("gene_id"))
# Filter for input gene symbols
result_df <- gene_locations_df %>%
dplyr::filter(gene_name %in% gene_symbols) %>%
dplyr::select(gene_symbol = gene_name, chr = seqnames, bp_start = start, bp_end = end, strand)
# Clean up chromosome names and strand
result_df <- result_df %>%
dplyr::mutate(
chr = sub("^NC_0*([0-9XYMT]+)\\..*$", "\\1", chr)
)
# If input was a data frame, append the results
if (is.data.frame(genes)) {
final_df <- genes %>%
dplyr::left_join(result_df, by = stats::setNames("gene_symbol", gene_col))
return(final_df)
} else {
return(result_df)
}
#' @importFrom rtracklayer import
#' @examples
#' \dontrun{
#' gene_symbols <- c("TP53", "BRCA1", "EGFR")
#' map_using_gtf(genes = gene_symbols, genome = "hg38")
#'
#' gene_symbols_df <- data.frame(GeneName = gene_symbols, OtherInformation = c(1,2,3))
#' map_using_gtf(genes = gene_symbols_df, gene_col = "GeneName" , genome = "hg19")
#' }
#' @export
map_using_gtf <- function(genes, gene_col = NULL, genome = c("hg19", "hg38"), gtf_file = NULL, download_dir = "~/project/ref/gtf") {
genome <- match.arg(genome)
# Process input genes
if (is.data.frame(genes)) {
if (is.null(gene_col) || !(gene_col %in% colnames(genes))) {
stop("Please specify a valid 'gene_col' that exists in the data frame.")
}
gene_col_sym <- rlang::sym(gene_col)
gene_symbols <- genes %>% dplyr::pull(!!gene_col_sym)
input_df <- genes
} else if (is.vector(genes)) {
gene_symbols <- genes
input_df <- data.frame(gene_symbol = gene_symbols, stringsAsFactors = FALSE)
} else {
stop("Input 'genes' must be a vector or a data frame.")
}
# Set default download directory
if (is.null(download_dir)) { download_dir <- "~/project/ref/gtf" }
if (!dir.exists(download_dir)) { dir.create(download_dir, recursive = TRUE) }
message(paste0(">>> Setting the download_dir: ", download_dir, "\n"))
# Download GTF file if not provided
if (is.null(gtf_file)) {
if (genome == "hg19") {
# gtf_url <- "ftp://ftp.ensembl.org/pub/grch37/current/gtf/homo_sapiens/Homo_sapiens.GRCh37.87.gtf.gz"
gtf_url <- "https://ftp.ncbi.nlm.nih.gov/refseq/H_sapiens/annotation/GRCh37_latest/refseq_identifiers/GRCh37_latest_genomic.gtf.gz"
gtf_file <- file.path(download_dir, basename(gtf_url))
} else if (genome == "hg38") {
# gtf_url <- "ftp://ftp.ensembl.org/pub/release-108/gtf/homo_sapiens/Homo_sapiens.GRCh38.108.gtf.gz"
gtf_url <- "https://ftp.ncbi.nlm.nih.gov/refseq/H_sapiens/annotation/GRCh38_latest/refseq_identifiers/GRCh38_latest_genomic.gtf.gz"
gtf_file <- file.path(download_dir, basename(gtf_url))
}
if (!file.exists(gtf_file)) {
message("Downloading GTF file...")
utils::download.file(gtf_url, destfile = gtf_file)
}
}
# Create TxDb object from GTF file
message("Creating TxDb object from GTF file...")
txdb <- suppressWarnings( GenomicFeatures::makeTxDbFromGFF(gtf_file, format = "gtf") )
# Retrieve gene locations
gene_locations <- GenomicFeatures::genes(txdb)
gene_locations_df <- as.data.frame(gene_locations)
# Import GTF file to get gene symbols
message("Importing GTF file to get gene symbols...")
gtf_data <- rtracklayer::import(gtf_file)
# Determine available attribute columns
available_cols <- names(S4Vectors::mcols(gtf_data))
if ("gene_name" %in% available_cols) {
gene_id_col <- "gene_id"
gene_name_col <- "gene_name"
} else if ("gene" %in% available_cols) {
gene_id_col <- "gene_id"
gene_name_col <- "gene"
} else {
stop("Neither 'gene_name' nor 'gene' columns are present in the GTF file.")
}
gene_symbols_map <- unique(S4Vectors::mcols(gtf_data)[, c(gene_id_col, gene_name_col)])
colnames(gene_symbols_map) <- c("gene_id", "gene_name")
gene_symbols_map <- as.data.frame(gene_symbols_map)
# Merge gene locations with gene symbols
gene_locations_df <- gene_locations_df %>%
dplyr::left_join(gene_symbols_map, by = c("gene_id"))
# Filter for input gene symbols
result_df <- gene_locations_df %>%
dplyr::filter(gene_name %in% gene_symbols) %>%
dplyr::select(gene_symbol = gene_name, chr = seqnames, bp_start = start, bp_end = end, strand)
# Clean up chromosome names and strand
result_df <- result_df %>%
dplyr::mutate(
chr = sub("^NC_0*([0-9XYMT]+)\\..*$", "\\1", chr)
)
# If input was a data frame, append the results
if (is.data.frame(genes)) {
final_df <- genes %>%
dplyr::left_join(result_df, by = stats::setNames("gene_symbol", gene_col))
return(final_df)
} else {
return(result_df)
}
}
map_using_gtf(genes = gene_symbols_df, gene_col = "GeneName" , genome = "hg19")
gc()
# update function information
devtools::document()
# update function information
devtools::document()
usethis::use_testthat()
library(testthat)
library(leo.gwas)
test_check("leo.gwas")
#
usethis::use_git()
usethis::use_github(protocol = "ssh")
# update function information
devtools::document()
# update function information
devtools::document()
#
usethis::use_version("minor")
devtools::install_github("laleoarrow/leo.gwas")
devtools::install_github("laleoarrow/leo.gwas")
library(leo.gwas)
detach("package:leo.gwas", unload = TRUE)
# update function information
devtools::document()
devtools::install_github("laleoarrow/leo.gwas")
library(leo.gwas)
detach("package:leo.gwas", unload = TRUE)
devtools::install_github("laleoarrow/leo.gwas")
library(leo.gwas)
detach("package:leo.gwas", unload = TRUE)
# update function information
devtools::document()
devtools::install_github("laleoarrow/leo.gwas")
library(leo.gwas)
detach("package:leo.gwas", unload = TRUE)
